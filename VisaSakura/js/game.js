"use strict";var game_view=new Vue({el:"#app",data:{stepPage:1,scenPage:1,person:"",mainber:"",canObj:{bg:"",deco:["./images/can-Deco_1.png","./images/can-Deco_2.png","./images/can-Deco_3.png"],food:"",item:""},shareImg:"",relationship:"",txtLen:0},methods:{transition:function(){this.transPage=!0,setTimeout(function(){sakuraBg(2e3,.2);var e=new TimelineMax({delay:.6});e.set(".step5 .word1",{opacity:0}),e.to(".step5 .word2",.9,{opacity:1})},50)},step1_scen1:function(){var e=this,t=new TimelineMax({delay:1.5,onComplete:function(){setTimeout(function(){e.scenPage=2,setTimeout(function(){e.step1_scen2()},10)},900)}});t.from(".step1 .scenes1",1.2,{opacity:0,y:50}),t.from(".step1 .word1",1.2,{opacity:0}),t.to(".step1 .word1",1.2,{opacity:0,top:200},"+=2.1")},step1_scen2:function(){var e=new TimelineMax;e.from(".step1 .scenes2 h2",.9,{opacity:0,y:50}),e.from(".step1 .scenes2 .selbtn1",.9,{opacity:0,x:-50}),e.from(".step1 .scenes2 .selbtn2",.9,{opacity:0,x:-50},"-=0.6"),e.from(".step1 .scenes2 .selbtn3",.9,{opacity:0,x:-50},"-=0.6"),e.from(".step1 .scenes2 .selbtn4",.9,{opacity:0,x:-50},"-=0.6"),e.set(".mask",{display:"none"})},step_sel:function(e){var t,n=this,s=Math.floor(4*Math.random())+1;"family"===e&&(n.relationship="家人",n.canObj.bg="./images/can-"+e+"-"+s+".jpg",t=".step1 .selbtn1"),"bf"===e&&(n.relationship="哥們",n.canObj.bg="./images/can-"+e+".jpg",t=".step1 .selbtn2"),"gf"===e&&(n.relationship="閨蜜",n.canObj.bg="./images/can-"+e+".jpg",t=".step1 .selbtn3"),"lover"===e&&(n.relationship="戀人",n.canObj.bg="./images/can-"+e+"-"+s+".jpg",t=".step1 .selbtn4"),setTimeout(function(){var e=new TimelineMax({onComplete:function(){setTimeout(function(){n.stepPage=2,n.scenPage=1,setTimeout(function(){n.step2_scen1()},10)},900)}});e.set(".mask",{display:"block"}),e.to(t,.3,{scale:1.05})},50)},step2_scen1:function(){var e=this;window.scrollTo(0,0);var t=new TimelineMax({delay:.9,onComplete:function(){setTimeout(function(){e.scenPage=2,setTimeout(function(){e.step2_scen2()},10)},300)}});t.from(".step2 .scenes1 .wordbg",.9,{opacity:0,y:50}),t.set(".step2 .scenes1 .shock",{opacity:1},"+=1.2"),t.from(".step2 .scenes1 .shock .content",.1,{opacity:0}),t.to(".step2 .scenes1 .shock .content",.1,{opacity:0}),t.to(".step2 .scenes1 .shock .content",.1,{opacity:1}),t.set(".step2 .scenes1 .wordbg",{opacity:0},"-=0.3"),t.set(".step2 .scenes1 .shock",{opacity:0},"+=1.5"),t.to(".step2 .scenes1 .stationbg",1.2,{scale:1.2})},step2_scen2:function(){var e=this,t=new TimelineMax({delay:.3,onComplete:function(){setTimeout(function(){$(".trans").addClass("transact"),setTimeout(function(){e.stepPage=3,e.scenPage=1,setTimeout(function(){$(".trans").removeClass("transact"),e.step3_scen1()},600)},900)},1800)}});t.from(".step2 .scenes2 .hand",.6,{opacity:0,x:150,y:100}),t.from(".step2 .scenes2 .wordbg",.6,{opacity:0,y:50})},step3_scen1:function(){window.scrollTo(0,0);var e=new TimelineMax({delay:.9});e.from(".step3 .scenes1 .wordbg",.9,{opacity:0,y:50}),e.to(".step3 .scenes1 .wordbg",.9,{opacity:0,y:-50},"+=1.2"),e.from(".step3 .scenes1 .selbox",.9,{opacity:0},"+=0.6"),e.from(".step3 .scenes1 .selbox h2",.9,{opacity:0,y:50},"+=0.6"),e.from(".step3 .scenes1 .selbtn1",.9,{opacity:0,x:-50}),e.from(".step3 .scenes1 .selbtn2",.9,{opacity:0,x:-50},"-=0.6"),e.from(".step3 .scenes1 .selbtn3",.9,{opacity:0,x:-50},"-=0.6"),e.set(".mask",{display:"none"})},step3_sel:function(e){var t,n=this;n.canObj.food="./images/can-"+e+".png","sasimi"===e&&(t=".step3 .scenes1 .selbtn1"),"tea"===e&&(t=".step3 .scenes1 .selbtn2"),"food"===e&&(t=".step3 .scenes1 .selbtn3");var s=new TimelineMax({onComplete:function(){setTimeout(function(){n.scenPage=2,setTimeout(function(){n.step3_scen2()},10)},300)}});s.set(".mask",{display:"block"}),s.to(t,.3,{scale:1.05}),s.set(".step3 .scenes1 .selbox",{opacity:0},"+=0.3"),s.set(".step3 .scenes1 .shock",{opacity:1}),s.from(".step3 .scenes1 .shock .content",.1,{opacity:0},"+=0.3"),s.to(".step3 .scenes1 .shock .content",.1,{opacity:0}),s.to(".step3 .scenes1 .shock .content",.1,{opacity:1}),s.set(".step3 .scenes1 .shock",{opacity:0},"+=1.5"),s.to(".step3 .scenes1 .storebg",.9,{scale:1.2})},step3_scen2:function(){var e=this,t=new TimelineMax({onComplete:function(){setTimeout(function(){$(".trans").addClass("transact"),setTimeout(function(){e.stepPage=4,e.scenPage=1,setTimeout(function(){$(".trans").removeClass("transact"),e.step4_scen1()},600)},900)},1800)}});t.from(".step3 .scenes2 .hand",.9,{opacity:1,x:100,y:200}),t.from(".step3 .scenes2 .wordbg",.9,{opacity:0,y:50},"+=0.6")},step4_scen1:function(){window.scrollTo(0,0);var e=new TimelineMax({delay:.9});e.from(".step4 .scenes1 .wordbg",.9,{opacity:0,y:50}),e.to(".step4 .scenes1 .wordbg",.9,{opacity:0,y:-50},"+=1.2"),e.from(".step4 .scenes1 .selbox",.9,{opacity:0},"+=0.6"),e.from(".step4 .scenes1 .selbox h2",.9,{opacity:0,y:50},"+=0.6"),e.from(".step4 .scenes1 .selbtn1",.9,{opacity:0,x:-50}),e.from(".step4 .scenes1 .selbtn2",.9,{opacity:0,x:-50},"-=0.6"),e.from(".step4 .scenes1 .selbtn3",.9,{opacity:0,x:-50},"-=0.6"),e.set(".mask",{display:"none"})},step4_sel:function(e){var t,n=this;n.canObj.item="./images/can-"+e+".png","kol"===e&&(t=".step4 .scenes1 .selbtn1"),"sing"===e&&(t=".step4 .scenes1 .selbtn2"),"tgame"===e&&(t=".step4 .scenes1 .selbtn3");var s=new TimelineMax({onComplete:function(){setTimeout(function(){n.scenPage=2,setTimeout(function(){n.step4_scen2()},10)},300)}});s.set(".mask",{display:"block"}),s.to(t,.3,{scale:1.05}),s.set(".step4 .scenes1 .selbox",{opacity:0},"+=0.3"),s.set(".step4 .scenes1 .shock",{opacity:1}),s.from(".step4 .scenes1 .shock .content",.1,{opacity:0},"+=0.3"),s.to(".step4 .scenes1 .shock .content",.1,{opacity:0}),s.to(".step4 .scenes1 .shock .content",.1,{opacity:1}),s.set(".step4 .scenes1 .shock",{opacity:0},"+=1.2"),s.to(".step4 .scenes1 .machinebg",.9,{top:-50,scale:1.25})},step4_scen2:function(){var e=this,t=new TimelineMax({delay:.6,onComplete:function(){setTimeout(function(){$(".trans").addClass("transact"),setTimeout(function(){e.stepPage=5,e.scenPage=1,setTimeout(function(){$(".trans").removeClass("transact"),e.step5_scen1()},600)},900)},1800)}});t.from(".step4 .scenes2 .hand",.9,{opacity:1,x:100,y:150}),t.from(".step4 .scenes2 .alert",.3,{opacity:0}),t.set(".step4 .scenes2 .alert",{opacity:0},"+=0.3"),t.from(".step4 .scenes2 .wordbg",.9,{opacity:0,y:50},"+=0.6"),t.set(".mask",{display:"none"},"+=1.2")},step5_scen1:function(){var e=this;window.scrollTo(0,0);var t=new TimelineMax({delay:.6,onComplete:function(){e.transition(),setTimeout(function(){e.scenPage=2,setTimeout(function(){e.resultCan()},500)},4200)}});t.from(".step5 .scenes1 .wordbg",.9,{opacity:0,y:50}),t.from(".step5 .scenes1 .word1",.9,{opacity:0}),t.to(".step5 .scenes1 .parkbg",3,{top:0})},resultCan:function(){var n=this,t=document.getElementById("rescan"),s=t.getContext("2d");t.width=1200,t.height=628,s.clearRect(0,0,t.width,t.height);var e,o,a,c=new Image,i=new Image,p=new Image,r=new Image,m=new Image,l=new Image,f=new Promise(function(e){c.addEventListener("load",function(){s.drawImage(c,0,0,c.width,c.height,0,0,t.width,t.height),e()}),c.src=n.canObj.bg}),d=new Promise(function(e){i.addEventListener("load",function(){e()});var t=Math.floor(Math.random()*n.canObj.deco.length);i.src=n.canObj.deco[t]}),u=new Promise(function(e){p.addEventListener("load",function(){e()}),p.src=n.canObj.food}),g=new Promise(function(e){r.addEventListener("load",function(){e()}),r.src=n.canObj.item}),h=new Promise(function(e){m.addEventListener("load",function(){e()}),m.src="./images/can-visa.png"}),y=new Promise(function(e){l.addEventListener("load",function(){e()}),l.src="./images/nameBg.png"});e=n.fbData.fbName.split(" ",2),o=e[1]?e[0]+" "+e[1]+"の"+n.relationship+"席":e[0]+"の"+n.relationship+"席",n.checkLen(o),7<=n.txtLen&&(a="bold 40px DFKangKaiStd-W5"),16<=n.txtLen&&(a="bold 36px DFKangKaiStd-W5"),n.txtLen<7&&(a="bold 60px DFKangKaiStd-W5"),f.then(function(){Promise.all([d,u,g,y,h]).then(function(){s.drawImage(i,0,0,i.width,i.height,1e3,0,200,200),s.drawImage(p,0,0,p.width,p.height,540,299,350,320),s.drawImage(r,0,0,r.width,r.height,974,222,220,330),s.drawImage(m,0,0,m.width,m.height,22,22,90,29),s.drawImage(l,0,0,l.width,l.height,47,498,l.width,l.height),s.font=a,s.textAlign="center",s.fillText(o,250,560,400),n.shareImg=t.toDataURL("image/jpeg",.8)})})},fbLogin:function(){var t=this;FB.getLoginStatus(function(e){"connected"===e.status?(t.fbData.fbtoken=e.authResponse.accessToken,t.fbData.fbId=e.authResponse.userID,FB.api("/me","GET",{fields:"id,name,picture"},function(e){t.fbData.fbName=e.name,t.fbData.fbPic="http://graph.facebook.com/"+e.id+"/picture?width=140&height=140"})):(alert("請先登入FB後入席賞櫻"),window.location.href="./index.html")})},replay:function(){window.location.href="./index.html"},sendImg:function(){var e=this;e.popup=!0,e.poPage="loading",e.getToken().then(function(){e.saveImg()})},saveImg:function(){var t=this,e=new FormData;return e.append("fbToken",t.fbData.fbtoken),e.append("shareImg",t.shareImg),e.append("relationship",t.relationship),$.ajax({url:"".concat(friendo_url,"VISASakuraMatsuri/img"),headers:{Authorization:"Bearer "+t.mainToken},data:e,method:"POST",processData:!1,contentType:!1}).done(function(e){t.fbLink=e.data.sharingUrl,t.popup=!0,t.poPage="yourlink"})},checkLen:function(e){var a=this;!function(e){for(var t,n=e.length,s=0,o=0;o<n;o++)for(t=e.charCodeAt(o);0<t;)s++,t>>=8;console.log(s),a.txtLen=s}(e)}},created:function(){},mounted:function(){var e,t,n,s,o=this;isMobile||(window.location="./index_pc.html"),$("body").loadpage("init",{async:!1}),document.querySelector("nav").style.display="none",window.scrollTo(0,0),o.step1_scen1(),window.fbAsyncInit=function(){FB.init({appId:"619022558645664",status:!0,cookie:!0,xfbml:!1,version:"v6.0"}),o.fbLogin()},e=document,t="facebook-jssdk",s=e.getElementsByTagName("script")[0],e.getElementById(t)||((n=e.createElement("script")).id=t,n.src="https://connect.facebook.net/en_US/sdk.js",s.parentNode.insertBefore(n,s))}});