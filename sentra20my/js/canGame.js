"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var carGame=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;_classCallCheck(this,t),this.speed=e,this.mainSize={width:window.innerWidth,height:window.innerHeight},this.rot=this.mainSize.height/this.mainSize.width,this.imgs={roadimg:{src:"./images/road.jpg"},userCar:{src:"./images/game_usercar.png"},userCarwan:{src:"./images/game_usercar_wan.png"},targetCar:{src:"./images/game_targetcar.png"},targetCarbrk:{src:"./images/game_targetcar_brk.png"},gameoverCar:{src:"./images/white_brakes_gameover.png"},scoreBg:{src:"./images/game-secondbg.png"},overimg:{src:"./images/gameover_near.jpg"}}}return _createClass(t,[{key:"init",value:function(){var i=this,r=document.querySelector("#canvas");r.width=i.mainSize.width,r.height=i.mainSize.height;var n,a,h,o,d,g,s,w,c,l=new Image,m=new Image,f=new Image,u=new Image,v=new Image,p=new Image,x=new Image,I=new Image,t=new Image,_=r.getContext("2d"),b=2,S=150,T=0,y=0,C=0,L=60,k=0,E=0,P=0,W=document.querySelector(".playbtn");l.src=i.imgs.roadimg.src,m.src=i.imgs.roadimg.src,f.src=i.imgs.userCar.src,u.src=i.imgs.userCarwan.src,v.src=i.imgs.targetCar.src,p.src=i.imgs.targetCarbrk.src,x.src=i.imgs.gameoverCar.src,I.src=i.imgs.scoreBg.src,t.src=i.imgs.overimg.src;var e=new Promise(function(e){l.onload=function(){e()}}),A=new Promise(function(e){m.onload=function(){e()}}),H=new Promise(function(e){f.onload=function(){e()}}),M=new Promise(function(e){u.onload=function(){e()}}),N=new Promise(function(e){v.onload=function(){e()}}),q=new Promise(function(e){p.onload=function(){e()}}),O=new Promise(function(e){x.onload=function(){e()}}),R=new Promise(function(e){I.onload=function(){e()}}),z=new Promise(function(e){t.onload=function(){e()}});function j(){n>r.height&&(n=-(l.height/i.rot-a)),a>r.height&&(a=-(m.height/i.rot-n)),_.clearRect(0,0,r.width,r.height),_.drawImage(l,0,0,l.width,l.height,0,n,r.width,l.height/i.rot),_.drawImage(m,0,0,m.width,m.height,0,a,r.width,m.height/i.rot),_.drawImage(I,0,0,I.width,I.height,r.width-I.width/2-10,20,I.width/2,I.height/2),n+=i.speed,a+=i.speed,70<=L&&(S-=b-.03*L),80<=L&&(S-=b-.02*L),100<=L&&(S-=(b=1)-.01*L),5<=T&&T<21&&(S-=b-.025*L,90<=L&&20<=++k&&(b=Math.random()<.5?-.1:2,k=0)),21<=T&&T<31&&(S-=b-.02*L,85<=L&&(10==++E&&(b=Math.random()<.5?-.1:2),13==E&&(b=Math.random()<.5?-.1:2),15<=E&&(E=0))),31<=T&&(S-=b-.01*L,80<=L&&(10==++P&&(b=Math.random()<.5?-.15:2),12==P&&(b=Math.random()<.5?-.15:2),13<=P&&(P=0))),S-=b-.03*L,_.fillStyle="#ffffff",_.font="italic 20px Helvetica",_.fillText("km/h",70,50),_.font="italic 30px Helvetica",_.shadowOffsetX=3,_.shadowOffsetY=3,_.shadowColor="rgba(0,0,0,0.3)",_.fillText(y,r.width-58,48),_.fillText(":",r.width-73,46),_.fillText(C,r.width-95,48),_.font="italic 40px Helvetica",_.fillText(Math.floor(L),20,50),_.drawImage(f,0,0,f.width,f.height,r.width/2-f.width/4,r.height-f.height/2-10,f.width/2,f.height/2),b<0?_.drawImage(p,0,0,v.width,v.height,r.width/2-v.width/4,S,v.width/2,v.height/2):_.drawImage(v,0,0,v.width,v.height,r.width/2-v.width/4,S,v.width/2,v.height/2);var e=0-v.height/2,t=r.height-f.height/2-v.height/2+40;t-30<=S&&_.drawImage(u,0,0,u.width,u.height,r.width/2-u.width/4,r.height-u.height/2-10,u.width/2,u.height/2),t<=S&&(clearInterval(d),W.removeEventListener("touchstart",X),W.removeEventListener("touchend",Y),clearInterval(w),clearInterval(s),clearInterval(c),index_view.popup=!0,index_view.popPage="gameover",index_view.userScore=T,index_view.userMin=C,index_view.userSec=y,T<10&&(index_view.resultWord="才剛開始就累了!? 這要怎麼開車出門啊?<br>讓ALL NEW SENTRA來拯救你吧！"),10<=T&&T<=30&&(index_view.resultWord="感覺到疲憊了嗎?現實可沒這麼輕鬆呢~<br>輕鬆更有型就靠ALL NEW SENTRA！"),31<=T&&(index_view.resultWord="太潮了吧!你該不會一個人開車環過島?<br>那你一定要試試ALL NEW SENTRA！"),setTimeout(function(){index_view.popup=!1,index_view.popPage="";h=-x.height/2,g=setInterval(function(){n+=8,a+=8,h+=8,_.clearRect(0,0,r.width,r.height),_.drawImage(l,0,0,l.width,l.height,0,n,r.width,l.height/i.rot),_.drawImage(m,0,0,m.width,m.height,0,a,r.width,m.height/i.rot),_.drawImage(x,0,0,x.width,x.height,r.width/2-f.width/4,h,x.width/2,x.height/2),_.drawImage(I,0,0,I.width,I.height,r.width-I.width/2-10,20,I.width/2,I.height/2),_.fillStyle="#ffffff",_.font="italic 20px Helvetica",_.fillText("km/h",70,50),_.font="italic 30px Helvetica",_.shadowOffsetX=3,_.shadowOffsetY=3,_.shadowColor="rgba(0,0,0,0.3)",_.fillText(y,r.width-58,48),_.fillText(":",r.width-73,46),_.fillText(C,r.width-95,48),_.font="italic 40px Helvetica",_.fillText(Math.floor(L),20,50),_.drawImage(f,0,0,f.width,f.height,r.width/2-f.width/4,o,f.width/2,f.height/2),b<0?_.drawImage(p,0,0,v.width,v.height,r.width/2-v.width/4,S,v.width/2,v.height/2):_.drawImage(v,0,0,v.width,v.height,r.width/2-v.width/4,S,v.width/2,v.height/2),0<=h&&(clearInterval(g),setTimeout(function(){index_view.step="reason",index_view.reason="near"},1500))},20)},1500)),S<=e&&(clearInterval(d),W.removeEventListener("touchstart",X),W.removeEventListener("touchend",Y),clearInterval(w),clearInterval(s),clearInterval(c),index_view.popup=!0,index_view.popPage="gameover",index_view.userScore=T,index_view.userMin=C,index_view.userSec=y,T<10&&(index_view.resultWord="才剛開始就累了!? 這要怎麼開車出門啊?<br>讓ALL NEW SENTRA來拯救你吧！"),10<=T&&T<=30&&(index_view.resultWord="感覺到疲憊了嗎?現實可沒這麼輕鬆呢~<br>輕鬆更有型就靠ALL NEW SENTRA！"),31<=T&&(index_view.resultWord="太潮了吧!你該不會一個人開車環過島?<br>那你一定要試試ALL NEW SENTRA！"),setTimeout(function(){index_view.popup=!1,index_view.popPage="",index_view.step="reason",index_view.reason="far"},1200))}function X(e){e.preventDefault(),this.style.background="url(./images/game_brakes-on.png) center top no-repeat",this.style.backgroundSize="cover",clearInterval(w),s=setInterval(function(){L+=1.5,i.speed+=1.5,50<=i.speed&&(i.speed=50),99<=L&&(L=99)},300)}function Y(e){e.preventDefault(),this.style.background="url(./images/game_brakes-off.png) center top no-repeat",this.style.backgroundSize="cover",clearInterval(s),w=setInterval(function(){L-=2.5,i.speed-=.08*i.speed,i.speed<=15&&(i.speed=15),L<=60&&(L=60)},300)}Promise.all([e,A,H,M,N,q,O,R,z]).then(function(){n=-(l.height/i.rot-r.height),_.drawImage(l,0,0,l.width,l.height,0,n,r.width,l.height/i.rot),a=-(m.height/i.rot-n),_.drawImage(m,0,0,m.width,m.height,0,a,r.width,m.height/i.rot),o=r.height-f.height/2-10,_.drawImage(f,0,0,f.width,f.height,r.width/2-f.width/4,o,f.width/2,f.height/2),_.drawImage(v,0,0,v.width,v.height,r.width/2-v.width/4,S,v.width/2,v.height/2),_.drawImage(I,0,0,I.width,I.height,r.width-I.width/2-10,20,I.width/2,I.height/2),_.fillStyle="#ffffff",_.font="italic 20px Helvetica",_.fillText("km/h",70,50),_.font="italic 30px Helvetica",_.shadowOffsetX=3,_.shadowOffsetY=3,_.shadowColor="rgba(0,0,0,0.3)",_.fillText("00",r.width-58,48),_.fillText(":",r.width-73,48),_.fillText("0",r.width-95,48),_.font="italic 40px Helvetica",_.fillText(Math.floor(L),20,50)}),document.querySelector(".readmebtn").addEventListener("click",function(){index_view.popPage="gamestart",document.querySelector(".popup").style="background: none";var e=3,t=setInterval(function(){--e,(document.querySelector(".gamecun").innerHTML=e)<=0&&(document.querySelector(".gamecun").innerHTML="GO!!",clearInterval(t),setTimeout(function(){document.querySelector(".decoarr").style="display: none",document.querySelector(".popup").style="background: url(./images/popup_bg.png) center top repeat",index_view.popup=!1,index_view.popPage="",d=setInterval(j,20),W.addEventListener("touchstart",X),W.addEventListener("touchend",Y),c=setInterval(function(){T+=1,60<=(y+=1)&&(C+=1,y=0)},1e3)},1e3))},1e3)})}}]),t}();