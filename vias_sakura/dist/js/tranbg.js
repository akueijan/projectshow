"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var sakuraBg=function(i){var s=2*Math.PI;function l(){return 2*Math.random()-1}var c=function(){function t(){_classCallCheck(this,t),this.velocity=new Array(3),this.rotation=new Array(3),this.position=new Array(3),this.euler=new Array(3),this.size=1,this.alpha=1,this.zkey=0}return _createClass(t,[{key:"setVelocity",value:function(t,e,i){this.velocity[0]=t,this.velocity[1]=e,this.velocity[2]=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=t,this.rotation[1]=e,this.rotation[2]=i}},{key:"setPosition",value:function(t,e,i){this.position[0]=t,this.position[1]=e,this.position[2]=i}},{key:"setEulerAngles",value:function(t,e,i){this.euler[0]=t,this.euler[1]=e,this.euler[2]=i}},{key:"setSize",value:function(t){this.size=t}},{key:"update",value:function(t){this.position[0]+=this.velocity[0]*t,this.position[1]+=this.velocity[1]*t,this.position[2]+=this.velocity[2]*t,this.euler[0]+=this.rotation[0]*t,this.euler[1]+=this.rotation[1]*t,this.euler[2]+=this.rotation[2]*t}}]),t}(),r=function(){function e(t){_classCallCheck(this,e),this.scene=t,this.deltaTime=0,768<window.innerWidth?this.particleControl={particleNum:i,area:[20,40,40]}:this.particleControl={particleNum:3*i,area:[50,10,10]},this.geometry=new THREE.BufferGeometry,this.positions=new Float32Array(3*this.particleControl.particleNum),this.eulers=new Float32Array(3*this.particleControl.particleNum),this.sizes=new Float32Array(this.particleControl.particleNum),this.initParticle()}return _createClass(e,[{key:"initParticle",value:function(){var t=this.particleControl,e=t.particleNum,i=t.area;t.particles=new Array(e);for(var n=new THREE.Vector3,r=0,o=0;o<e;o++){t.particles[o]=new c;var a=t.particles[o];n.x=.3*l()+.8,n.y=.2*l()-1,n.z=.3*l()+.5,n.normalize(),r=5+1*Math.random(),n.multiplyScalar(r),a.setVelocity(n.x,n.y,n.z),a.setRotation(l()*s*.5,l()*s*.5,l()*s*.5),a.setPosition(l()*i[0],l()*i[1],l()*i[2]),a.setEulerAngles(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),a.setSize(4+1*Math.random())}this.geometry.setAttribute("position",new THREE.BufferAttribute(this.positions,3)),this.geometry.setAttribute("aEuler",new THREE.BufferAttribute(this.eulers,3)),this.geometry.setAttribute("aSize",new THREE.BufferAttribute(this.sizes,1)),this.uniforms={far:{type:"f",value:i[2]}},this.points=new THREE.Points(this.geometry,new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:"\n    attribute vec3 aEuler;\n    attribute float aSize;\n\n    varying float pAlpha;\n\n    varying vec3 normX;\n    varying vec3 normY;\n    varying vec3 normZ;\n\n    void main() {\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n        gl_PointSize = aSize * (300.0 / -mvPosition.z);\n\n        float pdist = length(mvPosition.xyz);\n        pAlpha = smoothstep(0.0, 1.0, (pdist - 0.1) / 400.);\n\n        // Caculate Normal\n        vec3 elrsn = sin(aEuler);\n        vec3 elrcs = cos(aEuler);\n        mat3 rotx = mat3(\n            1.0, 0.0, 0.0,\n        0.0, elrcs.x, elrsn.x,\n        0.0, -elrsn.x, elrcs.x\n        );\n        mat3 roty = mat3(\n        elrcs.y, 0.0, -elrsn.y,\n        0.0, 1.0, 0.0,\n        elrsn.y, 0.0, elrcs.y\n        );\n        mat3 rotz = mat3(\n        elrcs.z, elrsn.z, 0.0, \n        -elrsn.z, elrcs.z, 0.0,\n        0.0, 0.0, 1.0\n        );\n        mat3 rotmat = rotx * roty * rotz;\n\n        mat3 trrotm = mat3(\n        rotmat[0][0], rotmat[1][0], rotmat[2][0],\n        rotmat[0][1], rotmat[1][1], rotmat[2][1],\n        rotmat[0][2], rotmat[1][2], rotmat[2][2]\n        );\n        normX = trrotm[0];\n        normY = trrotm[1];\n        normZ = trrotm[2];\n    }\n    ",fragmentShader:"\n    precision highp float;\n\n    varying vec3 normX;\n    varying vec3 normY;\n    varying vec3 normZ;\n    varying float pAlpha;\n\n    float diffuse = 0.9;\n    float specular = 0.8;\n    float rstop = 0.1;\n\n    // pos orign r.ab\n    float ellipse(vec2 p, vec2 o, vec2 r) { \n        vec2 lp = (p - o) / r;\n        return length(lp) - 1.0;\n    }\n\n    void main() {\n        vec3 p = vec3(gl_PointCoord - vec2(0.5, 0.5), 0.0) * 2.0;\n        vec3 d = vec3(0.0, 0.0, -1.0);\n        float nd = normZ.z; //dot(-normZ, d);\n        if(abs(nd) < 0.0001) discard;\n\n        float np = dot(normZ, p);\n        vec3 tp = p + d * np / nd;//dot(-normZ, d) / dot(-normZ, p);\n        // Back 2D \n        vec2 coord = vec2(dot(normX, tp), dot(normY, tp));\n\n        // angle = 15 degree\n        const float flwrsn = 0.258819045102521;\n        const float flwrcs = 0.965925826289068;\n        mat2 flwrm = mat2(flwrcs, -flwrsn, flwrsn, flwrcs);\n        // abs => double [0,1]\n        vec2 flwrp = vec2(abs(coord.x), coord.y) * flwrm;\n        float r;\n        if(flwrp.x < 0.0) {\n        // middle part(double)\n            r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.36, 0.96) * 0.5);\n        } else {\n            // out part(double)\n            r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.58, 0.96) * 0.5);\n        }\n        if(r > rstop) discard;\n        // r = ellipse(flwrp, vec2(0.250,0.440), vec2(0.140,0.190));\n        vec3 col = mix(vec3(1.0, 0.8, 0.75), vec3(1.0, 0.9, 0.87), r);\n        \n        float grady = mix(0.0, 1.0, pow(coord.y * 0.5 + 0.5, 0.35));\n        col *= vec3(1.0, grady, grady);\n        col *= mix(0.8, 1.0, pow(abs(coord.x), 0.3));\n        col = col * diffuse + specular;\n        \n        float alpha = (0.5 - r / (rstop * 1.0));\n        alpha = smoothstep(0.0, 1.0, alpha) * pAlpha;\n        \n        // gl_FragColor = vec4(vec3(alpha), 1.);\n        // 櫻花顏色\n        gl_FragColor = vec4(col*0.65, 1);\n    }\n    "})),this.scene.add(this.points)}},{key:"repeatPos",value:function(t,e){for(var i=0;i<3;i++){var n=e[i];Math.abs(t.position[i])-.5*t.size>n&&(0<t.position[i]?t.position[i]-=2*n:t.position[i]+=2*n)}}},{key:"repeatEuler",value:function(t){for(var e=0;e<3;e++)t.euler[e]=t.euler[e]%s,t.euler[e]<0&&(t.euler[e]+=s)}},{key:"renderParticle",value:function(){for(var t=this.particleControl,e=t.particleNum,i=t.area,n=t.particles,r=0;r<e;r++){var o=n[r];o.update(this.deltaTime),this.repeatPos(o,i),this.repeatEuler(o),this.positions[3*r]=o.position[0],this.positions[3*r+1]=o.position[1],this.positions[3*r+2]=o.position[2],this.eulers[3*r]=o.euler[0],this.eulers[3*r+1]=o.euler[1],this.eulers[3*r+2]=o.euler[2],this.sizes[r]=o.size}this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.aEuler.needsUpdate=!0,this.geometry.attributes.aSize.needsUpdate=!0}},{key:"render",value:function(t){this.deltaTime=t,this.renderParticle()}}]),e}(),e=function(){function n(t,e){_classCallCheck(this,n),this.container=t,this.width=750,this.height=1330,this.clock=new THREE.Clock,(this.camera=new THREE.PerspectiveCamera(45,750/1330,1,1e3)).position.set(0,0,10);var i=this.renderer=new THREE.WebGLRenderer({antialias:!1,alpha:!0});i.domElement.id="canvasWebGL",i.setPixelRatio(window.devicePixelRatio),i.setSize(this.width,this.height),i.gammaFactor=2.2,i.setClearColor(0,1),i.setClearAlpha(0),t.appendChild(i.domElement),this.initScene(e),this.initEvents()}return _createClass(n,[{key:"initScene",value:function(t){var e=this.scene=new THREE.Scene;this.sakura=new r(e),this.animete(),"function"==typeof t&&t()}},{key:"initEvents",value:function(){window.addEventListener("resize",this.onWindowResize.bind(this),!1)}},{key:"onWindowResize",value:function(){this.width=750,this.height=1330,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height)}},{key:"animete",value:function(){var t=.5*this.clock.getDelta();this.sakura.render(t),this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animete.bind(this))}}]),n}();window.onload=function(){var t=document.querySelector("#tranarea");new e(t)}};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5iZy5qcyJdLCJuYW1lcyI6WyJzYWt1cmFCZyIsImNvdW50IiwiUEkyIiwiTWF0aCIsIlBJIiwic3ltbWV0cnlSYW5kb20iLCJyYW5kb20iLCJQYXJ0aWNsZSIsIl9jbGFzc0NhbGxDaGVjayIsInRoaXMiLCJ2ZWxvY2l0eSIsIkFycmF5Iiwicm90YXRpb24iLCJwb3NpdGlvbiIsImV1bGVyIiwicGFydGljbGVDb250cm9sIiwicGFydGljbGVOdW0iLCJhcmVhIiwiemtleSIsIl9jcmVhdGVDbGFzcyIsImtleSIsInZhbHVlIiwidngiLCJ2eSIsIlRIUkVFIiwidGVtcFZlbG9jaXR5IiwiaSIsInBhcnRpY2xlIiwicnkiLCJyeCIsInRlbXBWZWMzIiwibm9ybWFsaXplIiwibnoiLCJtdWx0aXBseVNjYWxhciIsInJ6Iiwic2V0Um90YXRpb24iLCJzZXRQb3NpdGlvbiIsInNpemUiLCJzIiwiZHQiLCJnZW9tZXRyeSIsInNldEF0dHJpYnV0ZSIsInVuaWZvcm1zIiwiU2FrdXJhIiwic2NlbmUiLCJwb2ludHMiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwibGltaXQiLCJhYnMiLCJCdWZmZXJHZW9tZXRyeSIsImluZGV4IiwiZXVsZXJzIiwiRmxvYXQzMkFycmF5Iiwic2l6ZXMiLCJpbml0UGFydGljbGUiLCJwYXJ0aWNsZXMiLCJ4IiwieSIsInoiLCJzZXRWZWxvY2l0eSIsInJlcGVhdEV1bGVyIiwicG9zaXRpb25zIiwic2V0RXVsZXJBbmdsZXMiLCJhdHRyaWJ1dGVzIiwibmVlZHNVcGRhdGUiLCJzZXRTaXplIiwicmVuZGVyUGFydGljbGUiLCJCdWZmZXJBdHRyaWJ1dGUiLCJmYXIiLCJ0eXBlIiwiY29udGFpbmVyIiwiY2FsbGJhY2siLCJTaGFkZXJNYXRlcmlhbCIsInZlcnRleFNoYWRlciIsImZyYWdtZW50U2hhZGVyIiwiY2xvY2siLCJDbG9jayIsInJlbmRlcmVyIiwiZG9tRWxlbWVudCIsImdhbW1hRmFjdG9yIiwiaW5pdEV2ZW50cyIsIl90aGlzJHBhcnRpY2xlQ29udHJvbCIsInVwZGF0ZSIsImRlbHRhVGltZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJ3aWR0aCIsImhlaWdodCIsImNhbWVyYSIsImFzcGVjdCIsInNldFBpeGVsUmF0aW8iLCJ0aW1lIiwic2FrdXJhIiwiTWFpblNjZW5lIiwiY29udGFpbmVyRWxlIiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJzZXQiLCJXZWJHTFJlbmRlcmVyIiwiYW50aWFsaWFzIiwiYWxwaGEiLCJpZCIsImRldmljZVBpeGVsUmF0aW8iLCJzZXRDbGVhckNvbG9yIiwic2V0Q2xlYXJBbHBoYSIsImFwcGVuZENoaWxkIiwiaW5pdFNjZW5lIiwiU2NlbmUiLCJhbmltZXRlIiwib25XaW5kb3dSZXNpemUiLCJiaW5kIiwidXBkYXRlUHJvamVjdGlvbk1hdHJpeCIsImdldERlbHRhIiwicmVuZGVyIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwib25sb2FkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIl0sIm1hcHBpbmdzIjoibVpBQUEsSUFBSUEsU0FBVyxTQUFTQyxHQUVwQixJQUFNQyxFQUFnQixFQUFWQyxLQUFLQyxHQUNqQixTQUFTQyxJQUNMLE9BQXVCLEVBQWhCRixLQUFLRyxTQUFpQixFQUVqQyxJQWdMUUMsRUF0TG1CLFdBdUx0QixTQUFBQSxJQUFBQyxnQkFBQUMsS0FBQUYsR0FuRUdFLEtBQUtDLFNBQVcsSUFBSUMsTUFBTSxHQXBIUEYsS0FBQUcsU0FBQSxJQUFBRCxNQUFBLEdBQUFGLEtBQUFJLFNBQUEsSUFBQUYsTUFBQSxHQUFBRixLQUFBSyxNQUFBLElBQUFILE1BQUEsR0EwTGJJLEtBQUFBLEtBQUFBLEVBQ0FDLEtBQUFBLE1BRkssRUFFUUMsS0FGUkMsS0FFaUJILEVBM0xULE9BQUFJLGFBQUFaLEVBQUEsQ0FBQSxDQUFBYSxJQUFBLGNBQUFDLE1BQUEsU0E2TFBDLEVBQUdDLEVBQUlDLEdBQ2ZDLEtBQUFBLFNBQVksR0FBaEJILEVBaEVBYixLQUFLQyxTQUFTLEdBQUthLEVBaUVuQmQsS0FBU2lCLFNBQVEsR0FBR1YsSUEvTEQsQ0FBQUksSUFBQSxjQUFBQyxNQUFBLFNBaU1YTSxFQUFRQyxFQUFHYixHQS9EbkJOLEtBQUtHLFNBQVMsR0FBS2lCLEVBaUVmQyxLQUFBQSxTQUFhekIsR0FBQUEsRUFDYnlCLEtBQUFBLFNBQWF6QixHQUFBQSxJQXBNRSxDQUFBZSxJQUFBLGNBQUFDLE1BQUEsU0FzTU5VLEVBQUFBLEVBQVRDLEdBQ0FQLEtBQUFBLFNBQWUsR0FBTXRCLEVBQ3JCMkIsS0FBQUEsU0FBU0csR0FBQUEsRUEvRGJ4QixLQUFLSSxTQUFTLEdBQUttQixJQXpJQSxDQUFBWixJQUFBLGlCQUFBQyxNQUFBLFNBMklSUSxFQUFJRCxFQUFJTSxHQXFFZlAsS0FBQUEsTUFBU1EsR0FBQUEsRUFuRWIxQixLQUFLSyxNQUFNLEdBQUtjLEVBeUVaRCxLQUFBQSxNQUFTUyxHQUFBQSxJQXROTSxDQUFBaEIsSUFBQSxVQUFBQyxNQUFBLFNBNE5mTSxHQTNFSmxCLEtBQUs0QixLQUFPQyxJQWpKTyxDQUFBbEIsSUFBQSxTQUFBQyxNQUFBLFNBb09uQmtCLEdBaEZBOUIsS0FBS0ksU0FBUyxJQUFNSixLQUFLQyxTQUFTLEdBQUs2QixFQUN2QzlCLEtBQUtJLFNBQVMsSUFBTUosS0FBS0MsU0FBUyxHQUFLNkIsRUFnRnZDOUIsS0FBSytCLFNBQVNDLElBQUFBLEtBQWEvQixTQUEzQixHQUEyQ2MsRUFFM0NmLEtBQUsrQixNQUFTQyxJQUFBQSxLQUFkN0IsU0FBQSxHQUF3Q1ksRUE5RXhDZixLQUFLSyxNQUFNLElBQU1MLEtBQUtHLFNBQVMsR0FBSzJCLEVBZ0ZwQzlCLEtBQUtpQyxNQUFMLElBQWdCakMsS0FBQUcsU0FBQSxHQUFBMkIsTUF6T0doQyxFQUFBLEdBME9Wb0MsRUExT1UsV0F5T0gsU0FBQUEsRUFBaEJDLEdBQUFwQyxnQkFBQUMsS0FBQWtDLEdBTUFsQyxLQUFLb0MsTUFBU0QsRUFHTkYsS0FBQUEsVUFBZUEsRUFRM0IsSUFBQUksT0FBQUMsV0FuRlF0QyxLQUFLTSxnQkFBa0IsQ0F2S1JDLFlBQUFmLEVBQUFnQixLQUFBLENBQUEsR0FBQSxHQUFBLEtBNlBYK0IsS0FBS2pDLGdCQUFULENBaEZJQyxZQUFtQixFQUFOZixFQWlGUmdELEtBQUl0QixDQUFBQSxHQUFTZCxHQUFBQSxLQUlqQkosS0FGRCtCLFNBR0ssSUFBQWhCLE1BQUEwQixlQUNEdkIsS0FBQUEsVUFBU2QsSUFBU3NDLGFBQWxCLEVBQTRCSCxLQUFRakMsZ0JBQXBDQyxhQUNIUCxLQUFBMkMsT0FBQSxJQUFBQyxhQUFBLEVBQUE1QyxLQUFBTSxnQkFBQUMsYUFDSlAsS0FBQTZDLE1BQUEsSUFBQUQsYUFBQTVDLEtBQUFNLGdCQUFBQyxhQUNKUCxLQUFBOEMsZUF2UWtCLE9BQUFwQyxhQUFBd0IsRUFBQSxDQUFBLENBQUF2QixJQUFBLGVBQUFDLE1BQUEsV0FBQSxJQUFBTixFQUFBTixLQUFBTSxnQkFBQUMsRUEyUVhXLEVBM1FXWCxZQUFBQyxFQTJRWFUsRUEzUVdWLEtBNFFuQkYsRUFBb0JvQyxVQUFXQSxJQUFLeEMsTUFBSUssR0FFcEMsSUFEQVcsSUFBQUEsRUFBZXdCLElBQWYzQixNQUF3QkcsUUEvRXhCRixFQUFlLEVBZ0ZYRSxFQUFTYixFQUFUWSxFQUFleUIsRUFBY3pCLElBQUEsQ0FDN0JDLEVBQUE2QixVQUFBOUIsR0FBQSxJQUFBbkIsRUFDSCxJQUFBb0IsRUFBQVosRUFBQXlDLFVBQUE5QixHQUVSSSxFQUFBMkIsRUFBQSxHQUFBcEQsSUFBQSxHQWxSc0J5QixFQUFBNEIsRUFBQSxHQUFBckQsSUFBQSxFQUFBeUIsRUFBQTZCLEVBQUEsR0FBQXRELElBQUEsR0FBQXlCLEVBQUFDLFlBb1JQTixFQUFBLEVBQ2dDVixFQUFMWixLQUFLWSxTQUF0Q0MsRUFETWlCLGVBQUFSLEdBQ2ErQixFQURiSSxZQXpFSjlCLEVBQVMyQixFQTRFUDNCLEVBQVVkLEVBQ1pXLEVBQVc2QixHQUdWSyxFQUFBQSxZQTFFRHhELElBQW1CSCxFQUFNLEdBNEV4QjRELElBQWlCbkMsRUFBU2QsR0FDMUJpRCxJQUFtQm5DLEVBQUFBLElBR25CeUIsRUFBUWhCLFlBQ1JnQixJQUFnQnpCLEVBQVNiLEdBQ3pCc0MsSUFBZ0J6QixFQUFTYixHQTFFMUJULElBQW1CWSxFQUFLLElBRzVCVSxFQUFTb0MsZUEyRVJ2QixLQUFTd0IsU0FBVzdELEtBQUFDLEdBQVk2RCxFQUNoQ3pCLEtBQVN3QixTQUFXN0QsS0FBekJDLEdBQW1DNkQsRUFDOUJ6QixLQUFTd0IsU0FBVzdELEtBQXpCQyxHQUFrQzZELEdBelNmdEMsRUFBQXVDLFFBQUEsRUFBQSxFQUFBL0QsS0FBQUcsVUE4U25CRyxLQUFLMEQsU0FBQUEsYUFBTCxXQUFBLElBQUEzQyxNQUFBNEMsZ0JBQUEzRCxLQUFBcUQsVUFBQSxJQUNIckQsS0FBQStCLFNBQUFDLGFBQUEsU0FBQSxJQUFBakIsTUFBQTRDLGdCQUFBM0QsS0FBQTJDLE9BQUEsSUEvU3NCM0MsS0FBQStCLFNBQUFDLGFBQUEsUUFBQSxJQUFBakIsTUFBQTRDLGdCQUFBM0QsS0FBQTZDLE1BQUEsSUFBQTdDLEtBQUFpQyxTQUFBLENBQUEyQixJQUFBLENBMk9YQyxLQUFNLElBM09LakQsTUFBQUosRUFBQSxLQW9UdkJSLEtBQUFvQyxPQUFZMEIsSUFBQUEsTUFBV0MsT0FBVS9ELEtBQUErQixTQW5FekIsSUFBSWhCLE1BQU1pRCxlQUFlLENBb0U3Qi9CLFNBQWlCNkIsS0FDakI3QixTQUNBZ0MsYUFqVFUsaXhDQThPRkMsZUFwUFcsdThEQTBUZEMsS0FBTGhDLE1BQWlCcEIsSUFBQUEsS0FBTXFELFVBMVRKLENBQUF6RCxJQUFBLFlBQUFDLE1BQUEsU0FvVVpSLEVBQVBJLEdBeEVBLElBQUssSUFBSWtDLEVBQVEsRUFBR0EsRUFBUSxFQUFHQSxJQUFTLENBMkVsQzJCLElBQVE5QixFQUFTOEIsRUFBQUEsR0FDUjNFLEtBRDJDOEMsSUFBQXRCLEVBQUFkLFNBQUFzQyxJQUFBLEdBQUF4QixFQUFBVSxLQUFBVyxJQUExRCxFQUFBckIsRUFBQWQsU0FBQXNDLEdBSVM0QixFQUFnQmxFLFNBQUFzQyxJQUF6QixFQUFBSCxFQUdTZ0MsRUFBVG5FLFNBQUFzQyxJQUFBLEVBQUFILE1BOVVtQixDQUFBNUIsSUFBQSxjQUFBQyxNQUFBLFNBMlFYTSxHQTJFSHNELElBQUFBLElBQUw5QixFQUFBLEVBQUFBLEVBQUEsRUFBQUEsSUFDSHhCLEVBQUFiLE1BQUFxQyxHQUFBeEIsRUFBQWIsTUFBQXFDLEdBQUFqRCxFQXpFV3lCLEVBQVNiLE1BQU1xQyxHQUFTLElBOVFieEIsRUFBQWIsTUFBQXFDLElBQUFqRCxLQUFBLENBQUFrQixJQUFBLGlCQUFBQyxNQUFBLFdBQUEsSUEyVm5CLElBQUE2RCxFQUMwQ3pFLEtBQTFDTSxnQkFBT3lELEVBRFBVLEVBQ09WLFlBQWF2RCxFQURwQmlFLEVBQ29CakUsS0FBQXVDLEVBRHBCMEIsRUFDb0IxQixVQTVWRDlCLEVBQUEsRUFBQUEsRUFBQVYsRUFBQVUsSUFBQSxDQUFBLElBQUFDLEVBQUE2QixFQUFBOUIsR0FBQUMsRUFBQXdELE9BQUExRSxLQThWVjJFLFdBQ0ZDLEtBQUFBLFVBQVAxRCxFQUFBVixHQUNIUixLQUFBb0QsWUFBQWxDLEdBaFdzQmxCLEtBQUFxRCxVQUFBLEVBQUFwQyxHQUFBQyxFQUFBZCxTQUFBLEdBQUFKLEtBQUFxRCxVQUFBLEVBQUFwQyxFQUFBLEdBaVdOQyxFQUFBZCxTQUFBLEdBQ2JKLEtBQUFxRCxVQUFBLEVBQUFwQyxFQUFBLEdBQUFDLEVBQUFkLFNBQUEsR0FFS3lFLEtBQVFsQyxPQUFiLEVBQUExQixHQUFBQyxFQUFBYixNQUFBLEdBQ0t5RSxLQUFMbkMsT0FBQSxFQUFBMUIsRUFBQSxHQUFBQyxFQUFBYixNQUFBLEdBQ0swRSxLQUFPQyxPQUFTLEVBQXJCL0QsRUFBcUIsR0FBSzRELEVBQVF4RSxNQUFLeUUsR0FFbENULEtBQUx4QixNQUFjb0MsR0FBQUEsRUFBYzVDLEtBRS9CckMsS0FBQStCLFNBQUF3QixXQUFBLFNBQUFDLGFBQUEsRUExV3NCeEQsS0FBQStCLFNBQUF3QixXQUFBLE9BQUFDLGFBQUEsRUFBQXhELEtBQUErQixTQUFBd0IsV0FBQSxNQUFBQyxhQUFBLElBQUEsQ0FBQTdDLElBQUEsU0FBQUMsTUFBQSxTQTRTaEJzRSxHQWlFSGxGLEtBQUttRixVQUFjRCxFQUNuQmxGLEtBQUtxRSxxQkE5V2NuQyxFQUFBLEdBQUFrRCxFQUFBLFdBQUEsU0FBQUEsRUFBQXRCLEVBQUFDLEdBQUFoRSxnQkFBQUMsS0FBQW9GLEdBcVRuQnBGLEtBQUs4RCxVQUFZQSxFQWdFakJzQixLQUFKUCxNQUFjUSxJQUZsQnJGLEtBQUE4RSxPQUFBLEtBblhKOUUsS0FBQW1FLE1BQUEsSUFBQXBELE1BQUFxRCxPQTZUNEJwRSxLQUFLK0UsT0FBUyxJQUFJaEUsTUFBTXVFLGtCQUNwQyxHQUVBLElBQUksS0FDSixFQUNBLE1BRUdsRixTQUFTbUYsSUFBSSxFQUFHLEVBQUcsSUFHMUIsSUFBTWxCLEVBQVlyRSxLQUFLcUUsU0FBVyxJQUFJdEQsTUFBTXlFLGNBQWMsQ0FDdERDLFdBQVcsRUFDWEMsT0FBTyxJQUVYckIsRUFBU0MsV0FBV3FCLEdBQUssY0FDekJ0QixFQUFTWSxjQUFjNUMsT0FBT3VELGtCQUM5QnZCLEVBQVNaLFFBQVF6RCxLQUFLNkUsTUFBTzdFLEtBQUs4RSxRQUNsQ1QsRUFBU0UsWUFBYyxJQUN2QkYsRUFBU3dCLGNBQWMsRUFBVSxHQUNqQ3hCLEVBQVN5QixjQUFjLEdBRXZCaEMsRUFBVWlDLFlBQVkxQixFQUFTQyxZQUUvQnRFLEtBQUtnRyxVQUFVakMsR0FFZi9ELEtBQUt3RSxhQXRWYyxPQUFBOUQsYUFBQTBFLEVBQUEsQ0FBQSxDQUFBekUsSUFBQSxZQUFBQyxNQUFBLFNBd1ZibUQsR0FDTixJQUFNNUIsRUFBU25DLEtBQUttQyxNQUFRLElBQUlwQixNQUFNa0YsTUFDdENqRyxLQUFLbUYsT0FBUyxJQUFJakQsRUFBT0MsR0FDekJuQyxLQUFLa0csVUFDZSxtQkFBYm5DLEdBQTJCQSxNQTVWZixDQUFBcEQsSUFBQSxhQUFBQyxNQUFBLFdBK1ZuQnlCLE9BQU91QyxpQkFBaUIsU0FBVTVFLEtBQUttRyxlQUFlQyxLQUFLcEcsT0FBTyxLQS9WL0MsQ0FBQVcsSUFBQSxpQkFBQUMsTUFBQSxXQW9XbkJaLEtBQUs2RSxNQUFRLElBQ2I3RSxLQUFLOEUsT0FBUyxLQUNkOUUsS0FBSytFLE9BQU9DLE9BQVNoRixLQUFLNkUsTUFBUTdFLEtBQUs4RSxPQUN2QzlFLEtBQUsrRSxPQUFPc0IseUJBQ1pyRyxLQUFLcUUsU0FBU1ksY0FBYzVDLE9BQU91RCxrQkFDbkM1RixLQUFLcUUsU0FBU1osUUFBUXpELEtBQUs2RSxNQUFPN0UsS0FBSzhFLFVBeldwQixDQUFBbkUsSUFBQSxVQUFBQyxNQUFBLFdBNFduQixJQUFNc0UsRUFBNkIsR0FBdEJsRixLQUFLbUUsTUFBTW1DLFdBQ3hCdEcsS0FBS21GLE9BQU9vQixPQUFPckIsR0FDbkJsRixLQUFLcUUsU0FBU2tDLE9BQU92RyxLQUFLbUMsTUFBT25DLEtBQUsrRSxRQUN0Q3lCLHNCQUFzQnhHLEtBQUtrRyxRQUFRRSxLQUFLcEcsV0EvV3JCb0YsRUFBQSxHQW1YM0IvQyxPQUFPb0UsT0FBUyxXQUNaLElBQUlwQixFQUFlcUIsU0FBU0MsY0FBYyxhQUMxQyxJQUFJdkIsRUFBVUMiLCJmaWxlIjoidHJhbmJnLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHNha3VyYUJnID0gZnVuY3Rpb24oY291bnQpIHtcclxuXHJcbiAgICBjb25zdCBQSTIgPSBNYXRoLlBJICogMi4wO1xyXG4gICAgZnVuY3Rpb24gc3ltbWV0cnlSYW5kb20oKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCkgKiAyLjAgLSAxLjA7XHJcbiAgICB9XHJcbiAgICBjb25zdCB2ZXJ0ZXhTaGFkZXIgPSBgXHJcbiAgICBhdHRyaWJ1dGUgdmVjMyBhRXVsZXI7XHJcbiAgICBhdHRyaWJ1dGUgZmxvYXQgYVNpemU7XHJcblxyXG4gICAgdmFyeWluZyBmbG9hdCBwQWxwaGE7XHJcblxyXG4gICAgdmFyeWluZyB2ZWMzIG5vcm1YO1xyXG4gICAgdmFyeWluZyB2ZWMzIG5vcm1ZO1xyXG4gICAgdmFyeWluZyB2ZWMzIG5vcm1aO1xyXG5cclxuICAgIHZvaWQgbWFpbigpIHtcclxuICAgICAgICB2ZWM0IG12UG9zaXRpb24gPSBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7XHJcbiAgICAgICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbXZQb3NpdGlvbjtcclxuICAgICAgICBnbF9Qb2ludFNpemUgPSBhU2l6ZSAqICgzMDAuMCAvIC1tdlBvc2l0aW9uLnopO1xyXG5cclxuICAgICAgICBmbG9hdCBwZGlzdCA9IGxlbmd0aChtdlBvc2l0aW9uLnh5eik7XHJcbiAgICAgICAgcEFscGhhID0gc21vb3Roc3RlcCgwLjAsIDEuMCwgKHBkaXN0IC0gMC4xKSAvIDQwMC4pO1xyXG5cclxuICAgICAgICAvLyBDYWN1bGF0ZSBOb3JtYWxcclxuICAgICAgICB2ZWMzIGVscnNuID0gc2luKGFFdWxlcik7XHJcbiAgICAgICAgdmVjMyBlbHJjcyA9IGNvcyhhRXVsZXIpO1xyXG4gICAgICAgIG1hdDMgcm90eCA9IG1hdDMoXHJcbiAgICAgICAgICAgIDEuMCwgMC4wLCAwLjAsXHJcbiAgICAgICAgMC4wLCBlbHJjcy54LCBlbHJzbi54LFxyXG4gICAgICAgIDAuMCwgLWVscnNuLngsIGVscmNzLnhcclxuICAgICAgICApO1xyXG4gICAgICAgIG1hdDMgcm90eSA9IG1hdDMoXHJcbiAgICAgICAgZWxyY3MueSwgMC4wLCAtZWxyc24ueSxcclxuICAgICAgICAwLjAsIDEuMCwgMC4wLFxyXG4gICAgICAgIGVscnNuLnksIDAuMCwgZWxyY3MueVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgbWF0MyByb3R6ID0gbWF0MyhcclxuICAgICAgICBlbHJjcy56LCBlbHJzbi56LCAwLjAsIFxyXG4gICAgICAgIC1lbHJzbi56LCBlbHJjcy56LCAwLjAsXHJcbiAgICAgICAgMC4wLCAwLjAsIDEuMFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgbWF0MyByb3RtYXQgPSByb3R4ICogcm90eSAqIHJvdHo7XHJcblxyXG4gICAgICAgIG1hdDMgdHJyb3RtID0gbWF0MyhcclxuICAgICAgICByb3RtYXRbMF1bMF0sIHJvdG1hdFsxXVswXSwgcm90bWF0WzJdWzBdLFxyXG4gICAgICAgIHJvdG1hdFswXVsxXSwgcm90bWF0WzFdWzFdLCByb3RtYXRbMl1bMV0sXHJcbiAgICAgICAgcm90bWF0WzBdWzJdLCByb3RtYXRbMV1bMl0sIHJvdG1hdFsyXVsyXVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgbm9ybVggPSB0cnJvdG1bMF07XHJcbiAgICAgICAgbm9ybVkgPSB0cnJvdG1bMV07XHJcbiAgICAgICAgbm9ybVogPSB0cnJvdG1bMl07XHJcbiAgICB9XHJcbiAgICBgO1xyXG4gICAgY29uc3QgZnJhZ21lbnRTaGFkZXIgPSBgXHJcbiAgICBwcmVjaXNpb24gaGlnaHAgZmxvYXQ7XHJcblxyXG4gICAgdmFyeWluZyB2ZWMzIG5vcm1YO1xyXG4gICAgdmFyeWluZyB2ZWMzIG5vcm1ZO1xyXG4gICAgdmFyeWluZyB2ZWMzIG5vcm1aO1xyXG4gICAgdmFyeWluZyBmbG9hdCBwQWxwaGE7XHJcblxyXG4gICAgZmxvYXQgZGlmZnVzZSA9IDAuOTtcclxuICAgIGZsb2F0IHNwZWN1bGFyID0gMC44O1xyXG4gICAgZmxvYXQgcnN0b3AgPSAwLjE7XHJcblxyXG4gICAgLy8gcG9zIG9yaWduIHIuYWJcclxuICAgIGZsb2F0IGVsbGlwc2UodmVjMiBwLCB2ZWMyIG8sIHZlYzIgcikgeyBcclxuICAgICAgICB2ZWMyIGxwID0gKHAgLSBvKSAvIHI7XHJcbiAgICAgICAgcmV0dXJuIGxlbmd0aChscCkgLSAxLjA7XHJcbiAgICB9XHJcblxyXG4gICAgdm9pZCBtYWluKCkge1xyXG4gICAgICAgIHZlYzMgcCA9IHZlYzMoZ2xfUG9pbnRDb29yZCAtIHZlYzIoMC41LCAwLjUpLCAwLjApICogMi4wO1xyXG4gICAgICAgIHZlYzMgZCA9IHZlYzMoMC4wLCAwLjAsIC0xLjApO1xyXG4gICAgICAgIGZsb2F0IG5kID0gbm9ybVouejsgLy9kb3QoLW5vcm1aLCBkKTtcclxuICAgICAgICBpZihhYnMobmQpIDwgMC4wMDAxKSBkaXNjYXJkO1xyXG5cclxuICAgICAgICBmbG9hdCBucCA9IGRvdChub3JtWiwgcCk7XHJcbiAgICAgICAgdmVjMyB0cCA9IHAgKyBkICogbnAgLyBuZDsvL2RvdCgtbm9ybVosIGQpIC8gZG90KC1ub3JtWiwgcCk7XHJcbiAgICAgICAgLy8gQmFjayAyRCBcclxuICAgICAgICB2ZWMyIGNvb3JkID0gdmVjMihkb3Qobm9ybVgsIHRwKSwgZG90KG5vcm1ZLCB0cCkpO1xyXG5cclxuICAgICAgICAvLyBhbmdsZSA9IDE1IGRlZ3JlZVxyXG4gICAgICAgIGNvbnN0IGZsb2F0IGZsd3JzbiA9IDAuMjU4ODE5MDQ1MTAyNTIxO1xyXG4gICAgICAgIGNvbnN0IGZsb2F0IGZsd3JjcyA9IDAuOTY1OTI1ODI2Mjg5MDY4O1xyXG4gICAgICAgIG1hdDIgZmx3cm0gPSBtYXQyKGZsd3JjcywgLWZsd3JzbiwgZmx3cnNuLCBmbHdyY3MpO1xyXG4gICAgICAgIC8vIGFicyA9PiBkb3VibGUgWzAsMV1cclxuICAgICAgICB2ZWMyIGZsd3JwID0gdmVjMihhYnMoY29vcmQueCksIGNvb3JkLnkpICogZmx3cm07XHJcbiAgICAgICAgZmxvYXQgcjtcclxuICAgICAgICBpZihmbHdycC54IDwgMC4wKSB7XHJcbiAgICAgICAgLy8gbWlkZGxlIHBhcnQoZG91YmxlKVxyXG4gICAgICAgICAgICByID0gZWxsaXBzZShmbHdycCwgdmVjMigwLjA2NSwgMC4wMjQpICogMC41LCB2ZWMyKDAuMzYsIDAuOTYpICogMC41KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBvdXQgcGFydChkb3VibGUpXHJcbiAgICAgICAgICAgIHIgPSBlbGxpcHNlKGZsd3JwLCB2ZWMyKDAuMDY1LCAwLjAyNCkgKiAwLjUsIHZlYzIoMC41OCwgMC45NikgKiAwLjUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihyID4gcnN0b3ApIGRpc2NhcmQ7XHJcbiAgICAgICAgLy8gciA9IGVsbGlwc2UoZmx3cnAsIHZlYzIoMC4yNTAsMC40NDApLCB2ZWMyKDAuMTQwLDAuMTkwKSk7XHJcbiAgICAgICAgdmVjMyBjb2wgPSBtaXgodmVjMygxLjAsIDAuOCwgMC43NSksIHZlYzMoMS4wLCAwLjksIDAuODcpLCByKTtcclxuICAgICAgICBcclxuICAgICAgICBmbG9hdCBncmFkeSA9IG1peCgwLjAsIDEuMCwgcG93KGNvb3JkLnkgKiAwLjUgKyAwLjUsIDAuMzUpKTtcclxuICAgICAgICBjb2wgKj0gdmVjMygxLjAsIGdyYWR5LCBncmFkeSk7XHJcbiAgICAgICAgY29sICo9IG1peCgwLjgsIDEuMCwgcG93KGFicyhjb29yZC54KSwgMC4zKSk7XHJcbiAgICAgICAgY29sID0gY29sICogZGlmZnVzZSArIHNwZWN1bGFyO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZsb2F0IGFscGhhID0gKDAuNSAtIHIgLyAocnN0b3AgKiAxLjApKTtcclxuICAgICAgICBhbHBoYSA9IHNtb290aHN0ZXAoMC4wLCAxLjAsIGFscGhhKSAqIHBBbHBoYTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBnbF9GcmFnQ29sb3IgPSB2ZWM0KHZlYzMoYWxwaGEpLCAxLik7XHJcbiAgICAgICAgLy8g5qu76Iqx6aGP6ImyXHJcbiAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdmVjNChjb2wqMC42NSwgMSk7XHJcbiAgICB9XHJcbiAgICBgO1xyXG4gICAgY2xhc3MgUGFydGljbGUge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgQXJyYXkoMyk7XHJcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSBuZXcgQXJyYXkoMyk7XHJcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgQXJyYXkoMyk7XHJcbiAgICAgICAgICAgIHRoaXMuZXVsZXIgPSBuZXcgQXJyYXkoMyk7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZSA9IDEuMDtcclxuICAgICAgICAgICAgdGhpcy5hbHBoYSA9IDEuMDtcclxuICAgICAgICAgICAgdGhpcy56a2V5ID0gMC4wO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZXRWZWxvY2l0eSh2eCwgdnksIHZ6KXtcclxuICAgICAgICAgICAgdGhpcy52ZWxvY2l0eVswXSA9IHZ4O1xyXG4gICAgICAgICAgICB0aGlzLnZlbG9jaXR5WzFdID0gdnk7XHJcbiAgICAgICAgICAgIHRoaXMudmVsb2NpdHlbMl0gPSB2ejtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2V0Um90YXRpb24ocngsIHJ5LCByeikge1xyXG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uWzBdID0gcng7XHJcbiAgICAgICAgICAgIHRoaXMucm90YXRpb25bMV0gPSByeTtcclxuICAgICAgICAgICAgdGhpcy5yb3RhdGlvblsyXSA9IHJ6O1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZXRQb3NpdGlvbihueCwgbnksIG56KSB7XHJcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25bMF0gPSBueDtcclxuICAgICAgICAgICAgdGhpcy5wb3NpdGlvblsxXSA9IG55O1xyXG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9uWzJdID0gbno7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNldEV1bGVyQW5nbGVzKHJ4LCByeSwgcnopIHtcclxuICAgICAgICAgICAgdGhpcy5ldWxlclswXSA9IHJ4O1xyXG4gICAgICAgICAgICB0aGlzLmV1bGVyWzFdID0gcnk7XHJcbiAgICAgICAgICAgIHRoaXMuZXVsZXJbMl0gPSByejtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2V0U2l6ZShzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZSA9IHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZShkdCkge1xyXG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9uWzBdICs9IHRoaXMudmVsb2NpdHlbMF0gKiBkdDtcclxuICAgICAgICAgICAgdGhpcy5wb3NpdGlvblsxXSArPSB0aGlzLnZlbG9jaXR5WzFdICogZHQ7XHJcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25bMl0gKz0gdGhpcy52ZWxvY2l0eVsyXSAqIGR0O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5ldWxlclswXSArPSB0aGlzLnJvdGF0aW9uWzBdICogZHQ7XHJcbiAgICAgICAgICAgIHRoaXMuZXVsZXJbMV0gKz0gdGhpcy5yb3RhdGlvblsxXSAqIGR0O1xyXG4gICAgICAgICAgICB0aGlzLmV1bGVyWzJdICs9IHRoaXMucm90YXRpb25bMl0gKiBkdDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xhc3MgU2FrdXJhIHtcclxuICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSkge1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XHJcbiAgICAgICAgICAgIHRoaXMuZGVsdGFUaW1lID0gMDtcclxuICAgICAgICAgICAgLy8gdGhpcy5wYXJ0aWNsZUNvbnRyb2wgPSB7XHJcbiAgICAgICAgICAgIC8vICAgICBwYXJ0aWNsZU51bTogMTAwMCxcclxuICAgICAgICAgICAgLy8gICAgIGFyZWE6IFsxMC4wLCAxMC4wLCAxMC4wXSAvL+WNgOWfn+Wkp+Wwjywg5pW46YeP6ZaT6LedLCDoirHnk6PlpKflsI9cclxuICAgICAgICAgICAgLy8gfTtcclxuICAgICAgICAgICAgaWYod2luZG93LmlubmVyV2lkdGggPiA3NjgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFydGljbGVDb250cm9sID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlTnVtOiBjb3VudCwgLy/mlbjph49cclxuICAgICAgICAgICAgICAgICAgICBhcmVhOiBbMjAuMCwgNDAuMCwgNDAuMF0gLy/ljYDln5/lpKflsI8sIOmWk+i3nSwg6Iqx55Oj5aSn5bCPXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJ0aWNsZUNvbnRyb2wgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGVOdW06IGNvdW50KjMsIC8v5pW46YePXHJcbiAgICAgICAgICAgICAgICAgICAgYXJlYTogWzUwLjAsIDEwLjAsIDEwLjBdIC8v5Y2A5Z+f5aSn5bCPLCDplpPot50sIOiKseeTo+Wkp+Wwj1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBEYXRhXHJcbiAgICAgICAgICAgIHRoaXMuZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKTtcclxuICAgICAgICAgICAgdGhpcy5wb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMucGFydGljbGVDb250cm9sLnBhcnRpY2xlTnVtICogMyk7XHJcbiAgICAgICAgICAgIHRoaXMuZXVsZXJzID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLnBhcnRpY2xlQ29udHJvbC5wYXJ0aWNsZU51bSAqIDMpO1xyXG4gICAgICAgICAgICB0aGlzLnNpemVzID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLnBhcnRpY2xlQ29udHJvbC5wYXJ0aWNsZU51bSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdFBhcnRpY2xlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbml0UGFydGljbGUoKSB7XHJcbiAgICAgICAgICAgIGxldCB7IHBhcnRpY2xlQ29udHJvbCB9ID0gdGhpcztcclxuICAgICAgICAgICAgbGV0IHsgcGFydGljbGVOdW0sIGFyZWEgfSA9IHBhcnRpY2xlQ29udHJvbDtcclxuICAgICAgICAgICAgcGFydGljbGVDb250cm9sLnBhcnRpY2xlcyA9IG5ldyBBcnJheShwYXJ0aWNsZU51bSk7XHJcbiAgICAgICAgICAgIGxldCB0ZW1wVmVjMyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcbiAgICAgICAgICAgIGxldCB0ZW1wVmVsb2NpdHkgPSAwO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcnRpY2xlTnVtOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHBhcnRpY2xlQ29udHJvbC5wYXJ0aWNsZXNbaV0gPSBuZXcgUGFydGljbGUoKTtcclxuICAgICAgICAgICAgICAgIGxldCBwYXJ0aWNsZSA9IHBhcnRpY2xlQ29udHJvbC5wYXJ0aWNsZXNbaV07XHJcbiAgICAgICAgICAgICAgICAvLyBJbml0IFRyYW5zZm9ybVxyXG4gICAgICAgICAgICAgICAgdGVtcFZlYzMueCA9IHN5bW1ldHJ5UmFuZG9tKCkgKiAwLjMgKyAwLjg7XHJcbiAgICAgICAgICAgICAgICB0ZW1wVmVjMy55ID0gc3ltbWV0cnlSYW5kb20oKSAqIDAuMiAtIDEuMDtcclxuICAgICAgICAgICAgICAgIHRlbXBWZWMzLnogPSBzeW1tZXRyeVJhbmRvbSgpICogMC4zICsgMC41O1xyXG4gICAgICAgICAgICAgICAgdGVtcFZlYzMubm9ybWFsaXplKCk7XHJcbiAgICAgICAgICAgICAgICB0ZW1wVmVsb2NpdHkgPSA1LjAgKyBNYXRoLnJhbmRvbSgpICogMS4wO1xyXG4gICAgICAgICAgICAgICAgdGVtcFZlYzMubXVsdGlwbHlTY2FsYXIodGVtcFZlbG9jaXR5KTtcclxuICAgICAgICAgICAgICAgIC8vIFZlbG9jaXR5XHJcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5zZXRWZWxvY2l0eShcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wVmVjMy54LFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBWZWMzLnksXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcFZlYzMuelxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIC8vIFJvdGF0aW9uXHJcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5zZXRSb3RhdGlvbihcclxuICAgICAgICAgICAgICAgICAgICBzeW1tZXRyeVJhbmRvbSgpICogUEkyICogMC41LFxyXG4gICAgICAgICAgICAgICAgICAgIHN5bW1ldHJ5UmFuZG9tKCkgKiBQSTIgKiAwLjUsXHJcbiAgICAgICAgICAgICAgICAgICAgc3ltbWV0cnlSYW5kb20oKSAqIFBJMiAqIDAuNVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uXHJcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5zZXRQb3NpdGlvbihcclxuICAgICAgICAgICAgICAgICAgICBzeW1tZXRyeVJhbmRvbSgpICogYXJlYVswXSxcclxuICAgICAgICAgICAgICAgICAgICBzeW1tZXRyeVJhbmRvbSgpICogYXJlYVsxXSxcclxuICAgICAgICAgICAgICAgICAgICBzeW1tZXRyeVJhbmRvbSgpICogYXJlYVsyXVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIC8vIEV1bGVyXHJcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5zZXRFdWxlckFuZ2xlcyhcclxuICAgICAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDIuMCxcclxuICAgICAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDIuMCxcclxuICAgICAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDIuMFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIC8vIFNpemVcclxuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnNldFNpemUoNCArIE1hdGgucmFuZG9tKCkgKiAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBBdHRyaWJ1dGVzXHJcbiAgICAgICAgICAgIHRoaXMuZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUodGhpcy5wb3NpdGlvbnMsIDMpKTtcclxuICAgICAgICAgICAgdGhpcy5nZW9tZXRyeS5zZXRBdHRyaWJ1dGUoJ2FFdWxlcicsIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUodGhpcy5ldWxlcnMsIDMpKTtcclxuICAgICAgICAgICAgdGhpcy5nZW9tZXRyeS5zZXRBdHRyaWJ1dGUoJ2FTaXplJywgbmV3IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZSh0aGlzLnNpemVzLCAxKSk7XHJcbiAgICAgICAgICAgIC8vIFVuaWZvcm1zXHJcbiAgICAgICAgICAgIHRoaXMudW5pZm9ybXMgPSB7XHJcbiAgICAgICAgICAgICAgICBmYXI6IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZicsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGFyZWFbMl1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5wb2ludHMgPSBuZXcgVEhSRUUuUG9pbnRzKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5nZW9tZXRyeSxcclxuICAgICAgICAgICAgICAgIG5ldyBUSFJFRS5TaGFkZXJNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdW5pZm9ybXM6IHRoaXMudW5pZm9ybXMsXHJcbiAgICAgICAgICAgICAgICAgICAgdmVydGV4U2hhZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIGZyYWdtZW50U2hhZGVyLFxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQodGhpcy5wb2ludHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ3ljbGUgUG9zaXRpb24gXHJcbiAgICAgICAgcmVwZWF0UG9zKHBhcnRpY2xlLCBhcmVhKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCAzOyBpbmRleCsrKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbGltaXQgPSBhcmVhW2luZGV4XTtcclxuICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhwYXJ0aWNsZS5wb3NpdGlvbltpbmRleF0pIC0gcGFydGljbGUuc2l6ZSAqIDAuNSA+IGxpbWl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gT3V0IE9mIEFyZWFcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFydGljbGUucG9zaXRpb25baW5kZXhdID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5wb3NpdGlvbltpbmRleF0gLT0gbGltaXQgKiAyLjA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5wb3NpdGlvbltpbmRleF0gKz0gbGltaXQgKiAyLjA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDeWNsZSBFdWxlclxyXG4gICAgICAgIHJlcGVhdEV1bGVyKHBhcnRpY2xlKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCAzOyBpbmRleCsrKSB7XHJcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5ldWxlcltpbmRleF0gPSBwYXJ0aWNsZS5ldWxlcltpbmRleF0gJSBQSTI7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFydGljbGUuZXVsZXJbaW5kZXhdIDwgMC4wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuZXVsZXJbaW5kZXhdICs9IFBJMjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVuZGVyUGFydGljbGUoKXtcclxuICAgICAgICAgICAgbGV0IHsgcGFydGljbGVOdW0sIGFyZWEsIHBhcnRpY2xlcyB9ID0gdGhpcy5wYXJ0aWNsZUNvbnRyb2w7XHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBEYXRhXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFydGljbGVOdW07IGkrKykge1xyXG4gICAgICAgICAgICAgICAgbGV0IHBhcnRpY2xlID0gcGFydGljbGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgcGFydGljbGUudXBkYXRlKHRoaXMuZGVsdGFUaW1lKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVwZWF0UG9zKHBhcnRpY2xlLCBhcmVhKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVwZWF0RXVsZXIocGFydGljbGUpO1xyXG4gICAgICAgICAgICAgICAgLy8gUG9zaXRpb25cclxuICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb25zW2kqM10gPSBwYXJ0aWNsZS5wb3NpdGlvblswXTtcclxuICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb25zW2kqMysxXSA9IHBhcnRpY2xlLnBvc2l0aW9uWzFdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbnNbaSozKzJdID0gcGFydGljbGUucG9zaXRpb25bMl07XHJcbiAgICAgICAgICAgICAgICAvLyBSb3RhdGlvblxyXG4gICAgICAgICAgICAgICAgdGhpcy5ldWxlcnNbaSozXSA9IHBhcnRpY2xlLmV1bGVyWzBdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ldWxlcnNbaSozKzFdID0gcGFydGljbGUuZXVsZXJbMV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmV1bGVyc1tpKjMrMl0gPSBwYXJ0aWNsZS5ldWxlclsyXTtcclxuICAgICAgICAgICAgICAgIC8vIFNpemVcclxuICAgICAgICAgICAgICAgIHRoaXMuc2l6ZXNbaV0gPSBwYXJ0aWNsZS5zaXplO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZ2VvbWV0cnkuYXR0cmlidXRlc1sncG9zaXRpb24nXS5uZWVkc1VwZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuZ2VvbWV0cnkuYXR0cmlidXRlc1snYUV1bGVyJ10ubmVlZHNVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmdlb21ldHJ5LmF0dHJpYnV0ZXNbJ2FTaXplJ10ubmVlZHNVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVuZGVyKHRpbWUpIHtcclxuICAgICAgICAgICAgdGhpcy5kZWx0YVRpbWUgPSB0aW1lO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlclBhcnRpY2xlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBjbGFzcyBNYWluU2NlbmUge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgICAgIC8vIHRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgICAgICAgICAgLy8gdGhpcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSA3NTA7XHJcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gMTMzMDtcclxuICAgICAgICAgICAgdGhpcy5jbG9jayA9IG5ldyBUSFJFRS5DbG9jaygpO1xyXG5cclxuICAgICAgICAgICAgLy8gQ2FtZXJhXHJcbiAgICAgICAgICAgIGNvbnN0IGNhbWVyYSA9ICh0aGlzLmNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShcclxuICAgICAgICAgICAgICAgIDQ1LFxyXG4gICAgICAgICAgICAgICAgLy8gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCxcclxuICAgICAgICAgICAgICAgIDc1MC8xMzMwLFxyXG4gICAgICAgICAgICAgICAgMSxcclxuICAgICAgICAgICAgICAgIDEwMDBcclxuICAgICAgICAgICAgKSk7XHJcbiAgICAgICAgICAgIGNhbWVyYS5wb3NpdGlvbi5zZXQoMCwgMCwgMTApO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVuZGVyZXJcclxuICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSAodGhpcy5yZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHtcclxuICAgICAgICAgICAgICAgIGFudGlhbGlhczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBhbHBoYTogdHJ1ZVxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIHJlbmRlcmVyLmRvbUVsZW1lbnQuaWQgPSAnY2FudmFzV2ViR0wnO1xyXG4gICAgICAgICAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcclxuICAgICAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZSh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XHJcbiAgICAgICAgICAgIHJlbmRlcmVyLmdhbW1hRmFjdG9yID0gMi4yO1xyXG4gICAgICAgICAgICByZW5kZXJlci5zZXRDbGVhckNvbG9yKDB4MDAwMDAwLCAxKTtcclxuICAgICAgICAgICAgcmVuZGVyZXIuc2V0Q2xlYXJBbHBoYSgwKTtcclxuICAgICAgICAgICAgLy8gcmVuZGVyZXIuc2V0Q2xlYXJDb2xvckhleCggMHhmZmZmZmYsIDEgKTtcclxuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAvLyBTY2VuZVxyXG4gICAgICAgICAgICB0aGlzLmluaXRTY2VuZShjYWxsYmFjayk7XHJcbiAgICAgICAgICAgIC8vIEV2ZW50c1xyXG4gICAgICAgICAgICB0aGlzLmluaXRFdmVudHMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaW5pdFNjZW5lKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjZW5lID0gKHRoaXMuc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2FrdXJhID0gbmV3IFNha3VyYShzY2VuZSk7XHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWV0ZSgpO1xyXG4gICAgICAgICAgICB0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicgJiYgY2FsbGJhY2soKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaW5pdEV2ZW50cygpIHtcclxuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMub25XaW5kb3dSZXNpemUuYmluZCh0aGlzKSwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvbldpbmRvd1Jlc2l6ZSgpIHtcclxuICAgICAgICAgICAgLy8gdGhpcy53aWR0aCA9IGdldEVsZVdpZHRoKHRoaXMuY29udGFpbmVyKTtcclxuICAgICAgICAgICAgLy8gdGhpcy5oZWlnaHQgPSBnZXRFbGVIZWlnaHQodGhpcy5jb250YWluZXIpO1xyXG4gICAgICAgICAgICB0aGlzLndpZHRoID0gNzUwXHJcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gMTMzMFxyXG4gICAgICAgICAgICB0aGlzLmNhbWVyYS5hc3BlY3QgPSB0aGlzLndpZHRoIC8gdGhpcy5oZWlnaHQ7XHJcbiAgICAgICAgICAgIHRoaXMuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTaXplKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYW5pbWV0ZSgpIHtcclxuICAgICAgICAgICAgY29uc3QgdGltZSA9IHRoaXMuY2xvY2suZ2V0RGVsdGEoKSowLjU7IC8v6JC95LiL6YCf5bqmXHJcbiAgICAgICAgICAgIHRoaXMuc2FrdXJhLnJlbmRlcih0aW1lKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW5kZXIodGhpcy5zY2VuZSwgdGhpcy5jYW1lcmEpO1xyXG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5hbmltZXRlLmJpbmQodGhpcykpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB3aW5kb3cub25sb2FkID0gKCk9PiB7XHJcbiAgICAgICAgbGV0IGNvbnRhaW5lckVsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdHJhbmFyZWFcIik7XHJcbiAgICAgICAgbmV3IE1haW5TY2VuZShjb250YWluZXJFbGUpO1xyXG4gICAgfVxyXG59Il19
